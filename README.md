# JP Car Calc Bot

Telegram-бот на TypeScript с grammY для расчета стоимости ввоза авто из Японии по калькулятору Drom.

## Быстрый старт
- Скопируйте `.env.example` в `.env` и задайте `BOT_TOKEN` и `MONGODB_URI`.
- Установите зависимости: `npm install`.
- Запустите разработку: `npm run dev` (ts-node-dev, запускает `src/index.ts`).
- Бот использует MongoDB для кеша курсов и истории расчетов; убедитесь, что база доступна.

## Команды
- `/start` — описание и пошаговый сбор параметров: цена + валюта (JPY/USD/EUR), возраст, тип двигателя, объем, мощность. Расчет пока поддерживает возраст 3–5 лет.

## Структура
- `src/index.ts` — точка входа бота.
- `src/commands/` — обработчики команд и пошаговый диалог.
- `src/services/` — расчеты, работа с курсами ЦБ РФ, сохранение истории.
- `src/config/` — загрузка `.env`, подключение к MongoDB.
- `src/utils/` — форматирование и мелкие хелперы.

## Расчет (сжатая логика)
- Курсы валют берутся с `https://www.atb.su/services/exchange/` (поля usd2/eur2/jpy2) и кешируются по дате.
- Цена конвертируется в рубли; пошлина рассчитывается по диапазонам объема (3–5 лет), переводится из евро в рубли; далее таможенный сбор, утилизационный сбор (мощность и возраст), доставка 300 000 ₽.
- Результат и ввод сохраняются в MongoDB.

## Дополнительно
- Добавьте линтер/форматирование по желанию (скрипт `npm run lint` — заглушка).
- Для деплоя используйте `npm run build` и `npm start`.
